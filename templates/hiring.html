{% extends "base.html" %}
{% block content %}
<h1>Hiring Pipeline</h1>

<a href="/hiring/new" class="btn">+ Add Candidate</a>

{# ----- COLUMN VIEW BY STAGE (original) ----- #}
<h2>By Stage</h2>
<div class="cards">
  {% for stage, candidates_in_stage in by_stage.items() %}
  <div class="card" style="min-width: 160px;">
    <h3>{{ stage.name }}</h3>
    {% if candidates_in_stage %}
      <ul>
        {% for c in candidates_in_stage %}
          <li>
            <a href="/hiring/{{ c.id }}">{{ c.full_name }}</a>
            {% if c.position %}<br><small>{{ c.position }}</small>{% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p><em>No candidates</em></p>
    {% endif %}
  </div>
  {% endfor %}
</div>

{# ----- TABULAR INTERACTIVE PIPELINE ----- #}
<h2>Candidate Decisions (Tabular)</h2>

<table border="1" cellpadding="4" cellspacing="0">
  <thead>
    <tr>
      <th>Candidate</th>
      <th>Position</th>
      <th>Source</th>
      <th>Current Stage</th>
      <th>Next Step (Decision)</th>
    </tr>
  </thead>
  <tbody>
    {% for c in candidates %}
    <tr>
      <td>
        <a href="/hiring/{{ c.id }}">{{ c.full_name }}</a>
      </td>
      <td>{{ c.position or "-" }}</td>
      <td>{{ c.source or "-" }}</td>
      <td>{{ c.stage.name }}</td>
      <td>
        {% set next_stages = transitions[c.stage.name] %}
        {% if next_stages %}
        <form method="post" action="/hiring/{{ c.id }}/stage" style="display:inline;">
          <select name="stage">
            {% for s in next_stages %}
              <option value="{{ s }}">{{ s }}</option>
            {% endfor %}
          </select>
          <button type="submit">Move</button>
        </form>
        {% else %}
          <em>No further actions</em>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
